function reloadCharts(){return-1===navigator.userAgent.toLowerCase().indexOf("firefox")?!1:void $('.ui-widget-content [aria-expanded="false"]').find("iframe").each(function(){var t=$(this).attr("src");-1!==t.indexOf("charts")&&($(this).hide(),$(this).attr("src",t),$(this).show())})}function openDialogCenter(t){t.dialog("open");var i=getDimensions(t.parent());t.dialog({position:[i[0],i[1]]})}function getDimensions(t){var i=new Array(2);return i[0]=$(window).width()/2-t.width()/2,i[1]=$(window).height()/2-t.height()/2,i}function updateChart(t,i,e,n,o,r){var e=e,n=n,a=$("#iframe"+t).attr("default_src");a||(a=$("#iframe"+t).attr("src")),src=a.split("?")[0],("bar"===$("#type_"+t).val()||"column"===$("#type_"+t).val())&&0==$("#timescale_"+t).val().length&&0==$("#average_"+t).val().length&&0==$("#median_"+t).val().length&&0==$("#sum_"+t).val().length&&$("#timescale_"+t).val(30);var s=[];$(".chart_options"+t).each(function(){var t=$(this).val(),i=$(this).attr("id"),e=i.split("_")[0];t.length>0&&s.push([e,t])});for(var l="";s.length>0;){var c=s.pop();"width"==c[0]&&(e=parseInt(c[1])),"height"==c[0]&&(n=parseInt(c[1])),("type"!=c[0]||"line"!=c[1])&&(l+="&"+c[0]+"="+encodeURIComponent(c[1]))}l.length>0&&(src+="?"+l.substring(1)),i&&t>0&&r?$.update("/channels/"+o+"/charts/"+t,{newOptions:{options:l}}):i&&t>0&&$.update("/channels/"+o+"/charts/"+t,{options:l}),$("#embed"+t).val('<iframe width="'+e+'" height="'+n+'" style="border: 1px solid #cccccc;" src="'+src+'"></iframe>'),$("#iframe"+t).attr("src",src),$("#iframe"+t).attr("width",e),$("#iframe"+t).attr("height",n)}function updateSelectValues(){selectedValue=$(this).val(),$(".mutuallyexclusive"+index).each(function(){$(this).val("")}),$(this).val(selectedValue)}function setupChartForm(t){return function(i,e){e.length>0&&$("#"+e.split("=")[0]+"_"+t).val(decodeURIComponent(e.split("=")[1]))}}function setupColumns(t,i){$(sortColumnSetup(t,i)),$(".column").disableSelection()}function createWindowsWithData(t,i,e,n){for(var o in t){var r=t[o].window,a=r.window_type;colId=r.col,title=r.title;var s=r.html;"chart"===r.window_type&&$("body").append("<div id='chartConfig"+r.id+"'></div>");var l=addWindow(n,colId,r.id,a,title,s);l.each(decoratePortlet(i)),l.find(".ui-toggle").click(uiToggleClick),l.find(".ui-view").click(uiViewClick(e)),l.find(".ui-edit").click(uiEditClick(e)),l.find(".ui-close").click(uiCloseClick(e))}}function addWindow(t,i,e,n,o,r){if($("#"+t+"_dialog"+i).append('<div class="portlet ui-widget ui-widget-content ui-helper-clearfix ui-corner-all" id="portlet_'+e+'"><div class="portlet-header window_type window_type-'+n+' ui-widget-header  ui-corner-all">'+o+'</div><div class="portlet-content">'+r+"</div>"),$("#portlet_"+e).length>1)throw"Portlet count doesn't match what's expected";return $("#portlet_"+e)}function sortColumnSetup(t,i){$(".column").sortable({opacity:.6,helper:function(){return $("<div class='ui-widget-header'>Drop to re-position</div>")},connectWith:".column",update:updatePortletPositions(t,i)})}function getPortletArray(t){var e=new Array,n=t.split("&");for(i in n)val=n[i].split("=")[1],e.push(val);return e}function uiToggleClick(){$(this).toggleClass("ui-icon-minusthick").toggleClass("ui-icon-plusthick"),$(this).parents(".portlet:first").find(".portlet-content").toggle()}var createWindows=function(t,i,e){return function(n){createWindowsWithData(n,t,i,e)}},updatePortletPositions=function(t,i){return function(){if(t){var e=$(this).sortable("serialize");colId=$(this).attr("id").charAt($(this).attr("id").length-1),portletArray=getPortletArray(e),jsonResult={col:colId,positions:portletArray},portletArray.length>0&&$.ajax({type:"PUT",url:"../channels/"+i+"/windows",data:{_method:"PUT",page:JSON.stringify(jsonResult)},dataType:"json"})}}},decoratePortlet=function(t){return function(){var i=$(this).find(".portlet-header");return i.append("<span id='commentBtn' class='ui-view ui-icon ui-icon-comment'></span>"),thisObject=$(this),"true"==t?(thisObject.find(".window_type").prepend("<span id='minusBtn' class='ui-toggle ui-icon ui-icon-minusthick'></span>"),thisObject.find(".window_type-chart").append("<span id='pencilBtn' class='ui-edit ui-icon ui-icon-pencil'></span>"),thisObject.find(".window_type").append("<span id='closeBtn' class='ui-close ui-icon ui-icon-close'></span>"),thisObject.find(".portlet-header").css("cursor","move")):$(".column").sortable({disabled:!0}),$(this).attr("id")}},uiEditClick=function(t){return function(){var i=$(this).parents(".portlet:first").attr("id").substring(8),e="";$("#chartConfig"+i).load("/channels/"+t+"/charts/"+i+"/edit",function(){e=$("#chartOptions"+i).html(),"undefined"!=e&&e.length>2&&$.each(e.split("&amp;"),setupChartForm(i)),$("#button"+i).click(function(){updateChart(i,!0,450,250,t,!0),$("#chartConfig"+i).dialog("close")})}).dialog({title:"Chart Options",modal:!0,resizable:!1,width:500,dialogClass:"dev-info-dialog"})}},uiViewClick=function(t){return function(){var i=$(this).parents(".portlet:first").offset().left,e=$(this).parents(".portlet:first").offset().top,n=$(this).parents(".portlet:first").attr("id").substring(8);$("body").append('<div id="iframepopup'+n+'" style="display:none"><div id="iframeinner'+n+'"style="font-size:1.2em;overflow:auto;height:115px;background-color:white"></div></div>'),$.get("/channels/"+t+"/windows/"+n+"/iframe",function(t){var i=t.replace(/id=\"iframe[0-9]?[0-9]?[0-9]?[0-9]?[0-9]?[0-9]?[0-9]?[0-9]?[0-9]?[0-9]?\"/,"");$("#iframeinner"+n).text(i)}),$("#iframepopup"+n).dialog({resizable:!1,width:"300px",position:[i+200,e-200],title:"Chart Iframe",dialogClass:"dev-info-dialog"})}},uiCloseClick=function(t){return function(){var i=$(this).parents(".portlet:first").attr("id").substring(8),e=$(this).parents(".portlet:first");$.update("/channels/"+t+"/windows/"+i+"/hide",function(){e.hide("drop",function(){e.remove()})})}};